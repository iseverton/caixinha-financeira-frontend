<div
  class="h-full max-w-full bg-surface-100 px-4 py-4 rounded-xl shadow-lg overflow-hidden space-y-6"
>
  <!-- Header -->
  <div class="flex justify-between">
    <div class="flex flex-col gap-1">
      <h1 class="text-content-900 font-bold text-xl truncate">{{ goal().name }}</h1>
      <span class="text-content-300 text-sm">{{ goal().targetDate | date : 'dd/MM/yyyy' }}</span>
    </div>

    <div class="flex gap-4">
      <!-- update -->
      <div>
        <button (click)="openUpdateModal()" aria-label="Editar" class="p-1 hover:text-blue-600">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 
        2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 
        4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 
        14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 
        1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"
            />
          </svg>
        </button>

        @if (isUpdateModalOpen ()) {
        <dialog id="my_modal_3" class="modal modal-open">
          <div class="modal-box bg-surface-50 rounded">
            <form method="dialog">
              <button
                class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
                (click)="closeUpdateModal()"
              >
                ✕
              </button>
            </form>
            <div class="">
              <form
                #formControl="ngForm"
                (submit)="submitGoalUpdate(formControl)"
                class="flex flex-col gap-3"
              >
                <div>
                  <h1 class="text-xl text-content-900">Editar Meta</h1>
                  <p class="text-content-500">
                    Atualize as informações da sua meta e continue avançando rumo aos seus objetivos
                  </p>
                </div>

                <div class="flex flex-col">
                  <label>Nome</label>
                  <input
                    type="text"
                    placeholder="Ex: Viagem para a praia"
                    name="nome"
                    [(ngModel)]="updateGoal().name"
                    #nameControl="ngModel"
                    minlength="5"
                    required
                    class="border rounded-md focus:border-brand-500 px-2 py-1 text-sm text-content-900 placeholder-gray-300 focus:outline-none"
                  />

                  @if (nameControl.invalid && (nameControl.dirty || nameControl.touched)) {
                  @if(nameControl.hasError('required')) {
                  <span class="text-red-500">O campo nome é obrigatorio</span>
                  } @if (nameControl.hasError('minlength')) {
                  <span>O campo nome deve ter pelo menos 5 caracteres</span>
                  } }
                </div>

                <div class="flex flex-col">
                  <label>Valor da meta</label>
                  <input
                    type="number"
                    placeholder="1000.00"
                    name="valor"
                    [(ngModel)]="updateGoal().targetAmount"
                    #valorControl="ngModel"
                    required
                    class="border rounded-md focus:border-brand-500 px-2 py-1 text-sm text-content-900 placeholder-gray-300 focus:outline-none"
                  />

                  @if (valorControl.invalid && (valorControl.dirty || valorControl.touched)) {
                  @if(valorControl.hasError('required')) {
                  <span>O campo valor da meta é obrigatorio</span>
                  } }
                </div>

                <div class="flex flex-col">
                  <label>Data da meta</label>
                  <input
                    type="date"
                    name="data"
                    [(ngModel)]="updateGoal().targetDate"
                    #dataControl="ngModel"
                    required
                    class="border rounded-md focus:border-brand-500 px-2 py-1 text-sm text-content-900 placeholder-gray-300 focus:outline-none"
                  />

                  @if (dataControl.invalid && (dataControl.dirty || dataControl.touched)) {
                  @if(dataControl.hasError('required')) {
                  <span>O campo data da meta é obrigatorio</span>
                  } }
                </div>

                <div class="">
                  <button
                    type="submit"
                    class="bg-linear-to-r from-brand-300 to-brand-500 py-2 px-5 rounded-lg flex justify-center items-center gap-1 text-white"
                  >
                    Atualizar
                  </button>
                </div>
              </form>
            </div>
          </div>
        </dialog>
        }
      </div>

      <!-- delete -->
      <div>
        <button (click)="openDeleteModal()" aria-label="Excluir" class="p-1 hover:text-red-600">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 
                1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 
                1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 
                5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 
                .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 
                0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 
                51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 
                2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
            />
          </svg>
        </button>

        @if (isDeleteModalOpen ()) {
        <dialog id="my_modal_3" class="modal modal-open">
          <div class="modal-box bg-surface-50 rounded">
            <form method="dialog">
              <button
                class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
                (click)="closeDeleteModal()"
              >
                ✕
              </button>
            </form>
            <div class="">
              <h1 class="text-lg font-semibold mb-3">Confirmar exclusão</h1>

              <p class="text-sm text-gray-600 mb-5">Tem certeza que deseja deletar este item?</p>

              <button
                (click)="deleteGoal()"
                class="w-full py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition"
              >
                Deletar
              </button>
            </div>
          </div>
        </dialog>
        }
      </div>
    </div>
  </div>

  <!-- progress -->
  <div class="">
    <div class="flex justify-between">
      <span class="text-content-300 text-base">Progresso</span>
      <span class="text-content-900 font-bold text-base">{{ porcent() }}%</span>
    </div>
    <div>
      <progress
        class="progress progress-info w-full text-brand-700 rounded"
        [value]="porcent()"
        max="100"
      ></progress>
    </div>
  </div>

  <div class="flex justify-between">
    <div class="flex flex-col">
      <span class="text-content-300 text-base">Guardado</span>
      <span class="text-brand-700 font-semibold text-lg">{{
        goal().currentAmount | currency : 'BRL'
      }}</span>
    </div>
    <div class="flex flex-col">
      <span class="text-content-300 text-base">Meta</span>
      <span class="font-medium text-lg">{{ goal().targetAmount | currency : 'BRL' }}</span>
    </div>
  </div>

  <div class="flex justify-center bg-brand-100 py-1 rounded-xl">
    <p class="text-content-300 text-base">
      Faltam
      <span class="text-content-900 font-bold"> {{ amountRemaining() | currency : 'BRL' }}</span>
      para atingir sua meta
    </p>
  </div>

  <div class="flex items-center justify-center gap-4">
    <button
      (click)="openDepositModal()"
      class="bg-linear-to-r from-brand-300 to-brand-500 py-2 px-5 rounded-lg flex justify-center items-center gap-1 text-white"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="size-6"
      >
        <path
          fill-rule="evenodd"
          d="M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z"
          clip-rule="evenodd"
        />
      </svg>

      Adicionar
    </button>

    <button class="inline-flex border-brand-300 border py-2 px-5 rounded-lg items-center gap-1">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="size-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"
        />
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
        />
      </svg>

      <span>Ver Detalhes</span>
    </button>
  </div>

  @if (isDepositModalOpen()) {
  <dialog id="my_modal_3" class="modal modal-open">
    <div class="modal-box bg-surface-50 rounded">
      <form method="dialog">
        <button
          class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
          (click)="closeDepositModal()"
        >
          ✕
        </button>
      </form>
      <div>
        <h1>Adicionar Contribuição</h1>
        <p class="text-content-300">
          Adicione um valor guardado para
          <span class="text-content-900 font-bold">{{ goal().name }}</span>
        </p>

        <app-goal-deposit-form (depositModel)="makeDeposit($event)" />
      </div>
    </div>
  </dialog>
  }
</div>
